<div class="topMenuBar__buttonsWrapper">
  <div
    *ngFor="let button of buttons"
    class="topMenuBar__buttonWrapper">
    <button
      (click)="button.onClick()"
      [ngClass]="{
        'topMenuBar__button--enabled': button.enabled(),
        'topMenuBar__button--processing': getProcessingStatus(button.name) }"
      class="topMenuBar__button">
      <span class="topMenuBar__button__icon material-symbols-outlined">
        {{ button.icon }}
      </span>
    </button>
    <div
      *ngIf="showLabels"
      class="topMenuBar__button__text">
      {{ button.name }}
    </div>
  </div>

  <!-- TODO force close settings if window is resized and more button disappears -->
  <div
    class="
      topMenuBar__buttonWrapper
      topMenuBar__moreButton">
    <button
      cdkOverlayOrigin
      #trigger="cdkOverlayOrigin"
      (click)="toggleSettingsOpen()"
      [ngClass]="{ 'topMenuBar__button--enabled': isSettingsOpen }"
      class="topMenuBar__button">
      <span class="topMenuBar__button__icon material-symbols-outlined">
        more_vert
      </span>
    </button>
    <div
      *ngIf="showLabels"
      class="topMenuBar__button__text">
      More
    </div>
    <ng-template
      cdkConnectedOverlay
      [cdkConnectedOverlayOrigin]="trigger"
      [cdkConnectedOverlayOpen]="isSettingsOpen"
      [cdkConnectedOverlayPositions]="getOverlayPositions()"
      [cdkConnectedOverlayFlexibleDimensions]="true">
      <app-overlay-container
        [isOpen]="isSettingsOpen"
        [hasTopBorderRadius]="true">
        <div>
          <ng-container *ngTemplateOutlet="topMenuBarSettings"></ng-container>
        </div>
      </app-overlay-container>
    </ng-template>
  </div>
</div>

<div class="topMenuBar__deviceSelectorWrapper">
  <app-device-selector class="topMenuBar__deviceSelector">
  </app-device-selector>
</div>

<div class="topMenuBar__settingsWrapper">
  <ng-container *ngTemplateOutlet="topMenuBarSettings"></ng-container>
</div>

<div class="topMenuBar__liveViewWrapper">
  <app-live-view
    *ngIf="isLiveViewActive"
    class="topMenuBar__liveView">
</app-live-view>
</div>

<ng-template
  #topMenuBarSettings
  [formGroup]="topMenuBarForm">
  <app-color-slider
    [control]="topMenuBarForm.get('brightness')!"
    [min]="1"
    [max]="255"
    label="Brightness"
    labelClass="topMenuBar__slider__label"
    sliderClass="topMenuBar__slider__input"
    class="topMenuBar__slider">
    <!-- TODO another button should toggle light/dark mode? -->
    <span
      (click)="toggleTheme()"
      class="material-symbols-outlined">
      brightness_5
    </span>
  </app-color-slider>

  <div class="topMenuBar__transitionInputWrapper">
    <app-text-input
      label="Transition"
      [inputs]="[transitionInput]"
      suffix="sec"
      [hideValidity]="true">
    </app-text-input>
  </div>
</ng-template>
